
<!DOCTYPE html>
<html lang=cn>
<head>
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel=stylesheet type="text/css" href=https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;normalize.css>
        <link rel=stylesheet type="text/css" href=https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;style.css>
        <title>
    Lin Yinfeng
    - Rust 函数返回值书写问题
</title>
    
</head>
<body>
    
        <header id="header">
            
            
    <div class="header-container container">
        <h1 id="blog-title" class="title"><a href=https:&#x2F;&#x2F;www.linyinfeng.com>Lin Yinfeng</a></h1>
        <nav id="global-nav"><span class="global-nav-item-container"><a class="global-nav-item"
                    href=https:&#x2F;&#x2F;www.linyinfeng.com
                >Home</a></span><span class="global-nav-item-container"><a class="global-nav-item"
                    href=&#x2F;archive
                >Archive</a></span><span class="global-nav-item-container"><a class="global-nav-item"
                    href=https:&#x2F;&#x2F;github.com&#x2F;linyinfeng
                >GitHub</a></span><span class="global-nav-item-container"><a class="global-nav-item"
                    href=https:&#x2F;&#x2F;github.com&#x2F;linyinfeng&#x2F;blog
                >Source</a></span></nav>
    </div>

            
        </header>
        <div id="main-aside-container">
            
    
        
                <aside id="aside">
                    <div id="aside-container">
                        
    
    <div class="toc-container container">
        <h1 class="title toc-title">Table of Contents</h1>
        
    
        <ul class="toc-parent">
                
                <li class="toc-entry">
                    <a href=https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;posts&#x2F;rust-function-return-type-problem&#x2F;#rust-lei-xing-tui-li-type-inference-fan-wei>Rust 类型推理（Type inference）范围</a>
                    
    

                </li>
                
                <li class="toc-entry">
                    <a href=https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;posts&#x2F;rust-function-return-type-problem&#x2F;#fan-xing-lei-xing-can-shu-generic-type-parameters>泛型类型参数（Generic Type Parameters）</a>
                    
    

                </li>
                
        </ul>
    

    </div>


                    </div>
                </aside>
            
    

            <main id="main">
                <div id="main-container">
                    
    
                    
    
    <article class="article-container container">
        
    <h1 class="title article-title">
        <a class="article-title-link" href="https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;posts&#x2F;rust-function-return-type-problem&#x2F;">
            
    
        [Draft]
    
    Rust 函数返回值书写问题

        </a>
    </h1>

        
    <time datetime=2018-08-05T23:53:16+08:00>2018-08-05 23:53</time>

        
    <div class="article-taxonomies"><span class="article-taxonomy"><a class="article-taxonomy-name" href="https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;tags">
                Tags</a><span class="article-terms"><span class="article-term-name">rust</span><span class="article-term-name">类型系统</span></span></span><span class="article-taxonomy"><a class="article-taxonomy-name" href="https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;categories">
                Categories</a><span class="article-terms"><span class="article-term-name">笔记</span></span></span></div>

        
    
        <section class="article-license">
            
                <div class="license-image">
                    <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License" />
                </div>
            
            <small class="license">This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a></small>
        </section>
    

        <section class="article-content"><p>Rust 的类型系统是特别的。它的许多设计令我在使用之初感到疑惑，在使用了一段时间以后才领悟到它设计的目的。而在几周学习尝试 Rust 的过程中，这个类型系统令我感到最大的一个困惑就是函数返回值问题。这篇笔记将记录我的思考。</p>
<p><a name="continue-reading"></a></p>
<h1 id="rust-lei-xing-tui-li-type-inference-fan-wei"><a class="zola-anchor" href="#rust-lei-xing-tui-li-type-inference-fan-wei" aria-label="Anchor link for: rust-lei-xing-tui-li-type-inference-fan-wei">🔗</a>
Rust 类型推理（Type inference）范围</h1>
<p>初学 Rust 很可能遇到的一点疑惑就是：既然 Rust 的类型推理能力不弱，为什么甚至不能像在 C++ 中一样肆意书写 auto，尤其是在函数返回值中？</p>
<p>这主要是因为 Rust 做出的与一个设计决策：仅有局部类型推理，没有全局类型推理。所有非局部的名字的类型都是显式给出的。包括声明的函数（静态生命周期），静态变量，类型声明等。与此相反，局部变量，闭包等类型都是可以推出的。</p>
<p>这样做的好处是，无法使类型推导超越函数的边界，大大减轻了编译器定位错误的负担。使 Rust 编译器不容易像 C++ 编译器一样，因为某一个地方的小类型错误输出过深的报错信息。当然，这也限制了程序的表达能力，尤其是 Unboxed closure 加入后，闭包本身不携带函数指针，依赖编译期生成的唯一类型直接 impl 不同的 Fn trait 以提升效率，这使得 Rust 中的闭包的类型是无法书写的，造成在跨越边界的时候出现问题。</p>
<h1 id="fan-xing-lei-xing-can-shu-generic-type-parameters"><a class="zola-anchor" href="#fan-xing-lei-xing-can-shu-generic-type-parameters" aria-label="Anchor link for: fan-xing-lei-xing-can-shu-generic-type-parameters">🔗</a>
泛型类型参数（Generic Type Parameters）</h1>
</section>
    </article>


                </div>
            </main>
        </div>
        <footer id="footer">
            
            
    <div class="footer-container container">
        <div id="copyright-container">
            <small id="copyright">© Lin Yinfeng 2018</small>
        </div>
        
        
            <div id="powered-by-container">
                <small id="powered-by">Powered by <a href="https://github.com/gutenberg">Gutenberg</a></small>
            </div>
        
    </div>

            
        </footer>
    

    <script src=https:&#x2F;&#x2F;www.linyinfeng.com&#x2F;layout-helper.js></script>
</body>
</html>